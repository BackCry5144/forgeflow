-- ForgeFlow Database Initialization
-- ?뚯씠釉붿씠 議댁옱?섏? ?딆쓣 寃쎌슦?먮쭔 ?앹꽦

-- 1. menus ?뚯씠釉??앹꽦
CREATE TABLE IF NOT EXISTS menus (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    is_folder BOOLEAN NOT NULL DEFAULT FALSE,
    parent_id INTEGER,
    order_index INTEGER NOT NULL DEFAULT 0,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    FOREIGN KEY (parent_id) REFERENCES menus(id) ON DELETE CASCADE
);

-- menus ?뚯씠釉??몃뜳??
CREATE INDEX IF NOT EXISTS ix_menus_id ON menus(id);
CREATE INDEX IF NOT EXISTS ix_menus_parent_id ON menus(parent_id);

-- 2. screens ?뚯씠釉??앹꽦
CREATE TABLE IF NOT EXISTS screens (
    id SERIAL PRIMARY KEY,
    menu_id INTEGER NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    prompt TEXT,
    prototype_html TEXT,
    design_doc TEXT,
    test_plan TEXT,
    manual TEXT,
    status VARCHAR(50) NOT NULL DEFAULT 'draft',
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
    FOREIGN KEY (menu_id) REFERENCES menus(id) ON DELETE CASCADE,
    CONSTRAINT screens_status_check CHECK (status IN ('draft', 'in_review', 'approved'))
);

-- screens ?뚯씠釉??몃뜳??
CREATE INDEX IF NOT EXISTS ix_screens_id ON screens(id);
CREATE INDEX IF NOT EXISTS ix_screens_menu_id ON screens(menu_id);

-- 3. feedback ?뚯씠釉??앹꽦
CREATE TABLE IF NOT EXISTS feedback (
    id SERIAL PRIMARY KEY,
    screen_id INTEGER NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    FOREIGN KEY (screen_id) REFERENCES screens(id) ON DELETE CASCADE
);

-- feedback ?뚯씠釉??몃뜳??
CREATE INDEX IF NOT EXISTS ix_feedback_id ON feedback(id);
CREATE INDEX IF NOT EXISTS ix_feedback_screen_id ON feedback(screen_id);

-- 4. wizard_test_results ?뚯씠釉??앹꽦 (湲곗〈 003 留덉씠洹몃젅?댁뀡)
CREATE TABLE IF NOT EXISTS wizard_test_results (
    id SERIAL PRIMARY KEY,
    screen_id INTEGER NOT NULL,
    test_scenario TEXT NOT NULL,
    test_result TEXT NOT NULL,
    test_status VARCHAR(50) NOT NULL DEFAULT 'pending',
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    FOREIGN KEY (screen_id) REFERENCES screens(id) ON DELETE CASCADE
);

-- wizard_test_results ?뚯씠釉??몃뜳??
CREATE INDEX IF NOT EXISTS ix_wizard_test_results_id ON wizard_test_results(id);
CREATE INDEX IF NOT EXISTS ix_wizard_test_results_screen_id ON wizard_test_results(screen_id);

